function craft(t){this.energy=NITIAL_ENERGY,this.angle=NITIAL_ANGLE,this.id=t,this.radius=250+100*this.id,this.ele=$(".orbit"+this.id),this.fly,this.stay}function commander(){}function mediator(){}function consoleTable(){this.array=[]}function message(t,e){this.id=t,this.type=e}var SPEED=20,ENERGY_CONSUME=.5,ENERGY_SYSTEM=.2,NITIAL_ENERGY=100,NITIAL_ANGLE=90,WORN_PERCENT=.5,DELAY_TIME=1e3,LOSS_RATE=.3;craft.prototype={rcvCommand:function(t){var e=t.type;switch(this.fly&&clearInterval(this.fly),this.stay&&clearInterval(this.stay),e){case"create":this.createCraft();break;case"start":this.moveCraft();break;case"stop":this.stopCraft();break;case"destroy":this.destroyCraft()}printer.getInfo(t,"飞船")},moveCraft:function(){var t=this;this.fly=setInterval(function(){t.energy-=ENERGY_CONSUME,0==Math.round(t.energy)&&(t.stopCraft(),clearInterval(t.fly)),t.angle+=360*SPEED/(2*Math.PI*t.radius),t.ele.find(".craft"+t.id).css("transform","rotate("+t.angle+"deg)"),t.craftStateShow(t.energy)},500)},stopCraft:function(){var t=this;this.stay=setInterval(function(){t.energy+=ENERGY_SYSTEM,Math.round(t.energy)>=NITIAL_ENERGY&&clearInterval(t.stay),t.craftStateShow(t.energy)},500)},craftStateShow:function(t){var e=this.ele.find(".energy"),r=this.ele.find(".energyText");t>=0&&t<=NITIAL_ENERGY?(e.css("width",t+"%"),r.text(Math.round(t)),t<NITIAL_ENERGY*WORN_PERCENT?e.addClass("lack"):e.removeClass("lack")):console.log("The energy is out of range!The craft can't be displayed!"+t)},createCraft:function(){var t=Handlebars.compile($("#craftTemplate").html()),e={id:this.id};this.ele.html(t(e))},destroyCraft:function(){this.ele.empty(),this.energy=NITIAL_ENERGY,this.angle=NITIAL_ANGLE}},commander.prototype={sendInfo:function(t){printer.getInfo(t,"指挥官"),med.trans(t)}},mediator.prototype={trans:function(t){var e=Math.random()>LOSS_RATE,r=this;setTimeout(function(){e?r.sendToCraft(t):r.failToCraft(t)},DELAY_TIME)},sendToCraft:function(t){window["craftNo"+t.id].rcvCommand(t)},failToCraft:function(t){printer.getInfo(t,"警告")}},consoleTable.prototype={getInfo:function(t,e){var r={id:t.id,type:t.type,target:e};this.commandArray(r),this.printConsole(this.array)},commandArray:function(t){this.array.length>=7&&this.array.shift(),this.array.push(t)},printConsole:function(t){var e=Handlebars.compile($("#consoleTemplate").html()),r={cmd:t};$("#logInfo").html(e(r))}};var craftNo1=new craft(1),craftNo2=new craft(2),craftNo3=new craft(3),craftNo4=new craft(4),person=new commander,printer=new consoleTable,med=new mediator;$(".addBtn").on("click",function(){var t=$(this).closest(".out");t.find(".selected").removeClass("selected"),t.find(".hide:first").removeClass("hide").addClass("selected");var e=t.find(".selected span.name").data("num");msg=new message(e,"create"),person.sendInfo(msg),0==t.find(".hide").length&&$(this).addClass("hide")}),$(".innerIn").on("click",function(){if(!$(this).hasClass("slt")){var t=$(this).data("type"),e=$(this).closest(".innerOut"),r=e.find("span.name").data("num");$(this).addClass("slt"),$(this).siblings().removeClass("slt");var n=new message(r,t);switch(t){case"start":break;case"stop":break;case"destroy":e.addClass("hide"),$(this).removeClass("slt"),$(".addBtn").removeClass("hide")}person.sendInfo(n)}}),Handlebars.registerHelper("compare",function(t,e,r,n){if(arguments.length<3)throw new Error('Handlerbars Helper "compare" needs 2 parameters');var a={"==":function(t,e){return t==e},"===":function(t,e){return t===e},"!=":function(t,e){return t!=e},"!==":function(t,e){return t!==e},"<":function(t,e){return t<e},">":function(t,e){return t>e},"<=":function(t,e){return t<=e},">=":function(t,e){return t>=e},"typeof":function(t,e){return typeof t==e}};if(!a[e])throw new Error('Handlerbars Helper "compare" doesn\'t know the operator '+e);var s=a[e](t,r);return s?n.fn(this):n.inverse(this)});